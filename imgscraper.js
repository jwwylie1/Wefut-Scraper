const axios = require('axios');
const cheerio = require('cheerio');
const fs = require('fs');
const path = require('path');

/*LIST OF DEFECTIVE IMGS
807; 
*/

// Function to download the image
async function downloadImage(imageUrl, filename) {
  const writer = fs.createWriteStream(filename);

  const response = await axios({
    url: imageUrl,
    method: 'GET',
    responseType: 'stream',
  });

  response.data.pipe(writer);

  return new Promise((resolve, reject) => {
    writer.on('finish', resolve);
    writer.on('error', reject);
  });
}

// Main function to scrape the website and download the image
async function scrapeAndDownloadImage(url, filename) {
  try {
    // Fetch the webpage
    const { data } = await axios.get(url);

    // Load the HTML into cheerio
    const $ = cheerio.load(data);

    // Find the image with the class 'avatar'
    const imageUrl = $('img.avatar').attr('src');

    if (imageUrl) {
      // Handle relative URLs (if the image path is relative)
      const fullImageUrl = imageUrl.startsWith('http') ? imageUrl : new URL(imageUrl, url).href;

      // Define the local filename to save the image

      // Download the image
      await downloadImage(fullImageUrl, filename);
      console.log(`Image downloaded successfully and saved as ${filename}`);
    } else {
      console.log('No image found with class "avatar"');
    }
  } catch (error) {
    console.error('Error scraping the website:', error.message);
  }
}

// Replace with the URL of the website you want to scrape

var passes = 14050;

var nullsites = [282,498,546,786,962,966,993,997,1051,1160,1353,1370,1388,1426,1517,1521,1672,1674,1677,1723,1896,1901,1942,2031,2040,2131,2143,2215,2225,2270,2294,
  2392,2438,2457,2522,2523,2544,2583,2616,2645,2656,2664,2709,2858,2939,3079,3083,3091,3113,3254,3265,3339,3342,3348,3495,3524,3603,3637,3643,3783,3790,3791,3871,
  4012,4020,4039,4056,4064,4185,4193,4223,4235,4239,4314,4340,4414,4444,11651,11681,11732,11809,11880,11881,11938,12015,12024,12076,12091,12094,12095,12149,12231,
  12292,12303,12418,12422,12426,12485,12486,12516,12522,12540,12555,12572,12650,12660,12661,12666,1267,19404];
var NRBs = [11643,11644,11645,11646,11697,11706,11721,11726,11727,11733,11734,11744,11746,11752,11755,11759,11771,11772,11775,11777,11783,11785,11786,11789,11790,
  11796,11797,11799,11804,11808,11811,11813,11817,11820,11826,11833,11839,11841,11849,11856,11859,11860,11861,11865,11869,11870,11882,11884,11886,11887,11891,11896,
  11899,11901,11902,11906,11914,11915,11920,11923,11924,11928,11933,11950,11959,11961,11963,11966,11968,11969,11973,11979,11981,11982,11998,12000,12002,12003,12005,
  12006,12009,12014,12016,12017,12020,12026,12027,12028,12029,12031,12035,12038,12100,12101,12104,12109,12113,12117,12129,12138,12142,12148,12154,12155,12156,12161,
  12162,12164,12169,12176,12179,12181,12183,12190,12191,12193,12195,12198,12202,12203,12215,12217,12219,12223,12228,12241,12262,12268,12285,12287,12289,12295,12297,
  12298,12300,12309,12316,12317,12321,12325,12328,12332,12333,12334,12335,12339,12346,12349,12351,12353,12370,12376,12380,12387,12389,12397,12412,12415,12421,12424,
  12428,12430,12435,12436,12438,12440,12442,12448,12453,12459,12464,12469,12471,12476,12481,12483,12487,12496,12499,12500,12501,12504,12523,12527,12529,12552,12556,
  12559,12564,12585,12604,12612,12619,12624,12625,12640,12642,12645,12647,19411,19412,19413,19414,19415,19416,19417,19418,19678,19679,19680,19836,19837,19838,19839,
  19840,19841,19842,19843,19844,19845,19846,19847,19848,19849,19850,19851,19852,19853,19854,19859,19860,19861,19862,19863,19864,19865,19866,19867,19868,19869,19870,
  19871,19872,19873,19874,19875,19876,19877,19878,19879,19880,19881,19882,19883,19884,19885,19886,19887,19888,19889,19890,20048,20049,20050,20051,20052,20053,20054,
  20055,20056,20057,20058,20059,20060,20061,20062,20063,20064,20065,20066,20067,20068,20069,20070,20071,20072,20073,20074,20075,20076,20077,20078,20079,20080,20081,
  20082,20083,20084];

for (i=20100; i<20195; i++) {
  if (nullsites.includes(i) || NRBs.includes(i)) {
    passes += 1;
    continue;
  }
  var websiteUrl = 'https://wefut.com/player/25/' + i; // Change this URL
  var filename = './imgs/' + (i-1-passes) + '.png';
  scrapeAndDownloadImage(websiteUrl, filename);
}
